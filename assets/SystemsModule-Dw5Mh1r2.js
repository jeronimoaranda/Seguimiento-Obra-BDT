import{t as e}from"./activity-CITf3QsN.js";import{n as t,r as n,t as r}from"./Cards-D_8PyTS5.js";import{a as i,c as a,d as o,i as s,l as c,m as l,n as u,o as d,s as f}from"./index-CvE6lVIl.js";var p=i(`boxes`,[[`path`,{d:`M2.97 12.92A2 2 0 0 0 2 14.63v3.24a2 2 0 0 0 .97 1.71l3 1.8a2 2 0 0 0 2.06 0L12 19v-5.5l-5-3-4.03 2.42Z`,key:`lc1i9w`}],[`path`,{d:`m7 16.5-4.74-2.85`,key:`1o9zyk`}],[`path`,{d:`m7 16.5 5-3`,key:`va8pkn`}],[`path`,{d:`M7 16.5v5.17`,key:`jnp8gn`}],[`path`,{d:`M12 13.5V19l3.97 2.38a2 2 0 0 0 2.06 0l3-1.8a2 2 0 0 0 .97-1.71v-3.24a2 2 0 0 0-.97-1.71L17 10.5l-5 3Z`,key:`8zsnat`}],[`path`,{d:`m17 16.5-5-3`,key:`8arw3v`}],[`path`,{d:`m17 16.5 4.74-2.85`,key:`8rfmw`}],[`path`,{d:`M17 16.5v5.17`,key:`k6z78m`}],[`path`,{d:`M7.97 4.42A2 2 0 0 0 7 6.13v4.37l5 3 5-3V6.13a2 2 0 0 0-.97-1.71l-3-1.8a2 2 0 0 0-2.06 0l-3 1.8Z`,key:`1xygjf`}],[`path`,{d:`M12 8 7.26 5.15`,key:`1vbdud`}],[`path`,{d:`m12 8 4.74-2.85`,key:`3rx089`}],[`path`,{d:`M12 13.5V8`,key:`1io7kd`}]]),m=i(`chevron-right`,[[`path`,{d:`m9 18 6-6-6-6`,key:`mthhwq`}]]),h=i(`hammer`,[[`path`,{d:`m15 12-9.373 9.373a1 1 0 0 1-3.001-3L12 9`,key:`1hayfq`}],[`path`,{d:`m18 15 4-4`,key:`16gjal`}],[`path`,{d:`m21.5 11.5-1.914-1.914A2 2 0 0 1 19 8.172v-.344a2 2 0 0 0-.586-1.414l-1.657-1.657A6 6 0 0 0 12.516 3H9l1.243 1.243A6 6 0 0 1 12 8.485V10l2 2h1.172a2 2 0 0 1 1.414.586L18.5 14.5`,key:`15ts47`}]]),g=i(`target`,[[`circle`,{cx:`12`,cy:`12`,r:`10`,key:`1mglay`}],[`circle`,{cx:`12`,cy:`12`,r:`6`,key:`1vlfrh`}],[`circle`,{cx:`12`,cy:`12`,r:`2`,key:`1c9p78`}]]),_=i(`zap`,[[`path`,{d:`M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z`,key:`1xq2db`}]]),v=l(o(),1),y=a(),b=v.memo(({tagItem:e,onEdit:t,skidOptions:n,almacenOptions:r,isReadOnly:i})=>{let a=`hover:bg-slate-50`;e.calculatedStatus===`INSTALADO`?a=`bg-green-50/60`:e.calculatedStatus===`EN PROCESO`&&(a=`bg-yellow-50/60`);let o=`border border-slate-200 rounded px-1.5 py-0.5 text-xs w-full outline-none focus:ring-2 focus:ring-blue-500 transition-all disabled:bg-slate-100 disabled:text-slate-400`;return(0,y.jsxs)(`tr`,{className:`border-b border-slate-100 transition-colors ${a}`,children:[(0,y.jsx)(`td`,{className:`px-4 py-2 font-medium text-slate-800 w-32`,children:e.tag}),(0,y.jsx)(`td`,{className:`px-4 py-2 text-slate-500 text-[10px] truncate max-w-[150px]`,title:e.desc,children:e.desc}),(0,y.jsx)(`td`,{className:`px-2 py-1`,children:(0,y.jsxs)(`select`,{disabled:i,className:`${o} bg-white cursor-pointer`,value:e.skid||``,onChange:n=>t(e.tag,`skid`,n.target.value),children:[(0,y.jsx)(`option`,{value:``,children:`-`}),n.map(e=>(0,y.jsx)(`option`,{value:e,children:e},e))]})}),(0,y.jsx)(`td`,{className:`px-2 py-1`,children:(0,y.jsxs)(`select`,{disabled:i,className:`${o} bg-white cursor-pointer`,value:e.almacen||``,onChange:n=>t(e.tag,`almacen`,n.target.value),children:[(0,y.jsx)(`option`,{value:``,children:`-`}),r.map(e=>(0,y.jsx)(`option`,{value:e,children:e},e))]})}),(0,y.jsx)(`td`,{className:`px-2 py-1 text-center w-20`,children:(0,y.jsxs)(`select`,{disabled:i,className:`${o} bg-white cursor-pointer text-center`,value:e.aCalibrar||`0`,onChange:n=>t(e.tag,`aCalibrar`,n.target.value),children:[(0,y.jsx)(`option`,{value:`0`,children:`NO`}),(0,y.jsx)(`option`,{value:`1`,children:`SI`})]})}),(0,y.jsx)(`td`,{className:`px-2 py-1 w-16`,children:(0,y.jsx)(`input`,{disabled:i,type:`number`,className:`${o} text-center`,value:e.cantRegTot,onChange:n=>t(e.tag,`cantRegTot`,n.target.value),placeholder:`0`})}),(0,y.jsx)(`td`,{className:`px-2 py-1 w-16`,children:(0,y.jsx)(`input`,{disabled:i,type:`number`,className:`${o} text-center`,value:e.cantRegReal,onChange:n=>t(e.tag,`cantRegReal`,n.target.value),placeholder:`0`})}),(0,y.jsx)(`td`,{className:`px-2 py-1 text-center w-32`,children:(0,y.jsx)(`span`,{className:`text-[10px] font-bold px-2 py-1 rounded border ${e.calculatedStatus===`INSTALADO`?`text-green-700 bg-green-100 border-green-200`:e.calculatedStatus===`EN PROCESO`?`text-yellow-700 bg-yellow-100 border-yellow-200`:`text-slate-400 bg-slate-100 border-slate-200`}`,children:e.calculatedStatus})})]})}),x=({specialtyName:n,tags:r,onEdit:i,skidOptions:a,almacenOptions:o,isReadOnly:c})=>{let[l,d]=(0,v.useState)(!1),f=r.length,p=r.filter(e=>e.calculatedStatus===`INSTALADO`).length,x=f>0?(p/f*100).toFixed(0):0,S=r.filter(e=>e.calculatedStatus===`EN PROCESO`).length,C=f>0?(S/f*100).toFixed(0):0;return(0,y.jsxs)(`div`,{className:`border border-slate-200 rounded mb-2 overflow-hidden bg-white shadow-sm`,children:[(0,y.jsxs)(`div`,{className:`flex justify-between items-center p-2 px-3 cursor-pointer bg-slate-50 hover:bg-slate-100 transition-colors`,onClick:()=>d(!l),children:[(0,y.jsxs)(`div`,{className:`flex items-center gap-2`,children:[l?(0,y.jsx)(s,{size:14,className:`text-slate-400`}):(0,y.jsx)(m,{size:14,className:`text-slate-400`}),(0,y.jsxs)(`span`,{className:`font-bold text-slate-700 text-xs flex items-center gap-2`,children:[{Instrumentación:(0,y.jsx)(e,{size:14,className:`text-blue-500`}),Electricidad:(0,y.jsx)(_,{size:14,className:`text-yellow-500`}),Mecánica:(0,y.jsx)(t,{size:14,className:`text-gray-500`}),Piping:(0,y.jsx)(g,{size:14,className:`text-indigo-500`}),Civil:(0,y.jsx)(h,{size:14,className:`text-orange-500`})}[n]||(0,y.jsx)(u,{size:14}),` `,n]})]}),(0,y.jsxs)(`div`,{className:`flex items-center gap-4`,children:[(0,y.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,y.jsxs)(`span`,{className:`text-[10px] text-yellow-600 font-medium`,children:[S,` Proc.`]}),(0,y.jsx)(`div`,{className:`w-16 bg-gray-200 rounded-full h-1.5`,children:(0,y.jsx)(`div`,{className:`h-1.5 rounded-full bg-yellow-500`,style:{width:`${C}%`}})})]}),(0,y.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,y.jsxs)(`span`,{className:`text-[10px] text-slate-500 font-medium`,children:[p,`/`,f,` Inst.`]}),(0,y.jsx)(`div`,{className:`w-16 bg-gray-200 rounded-full h-1.5`,children:(0,y.jsx)(`div`,{className:`h-1.5 rounded-full ${x==100?`bg-green-500`:`bg-blue-500`}`,style:{width:`${x}%`}})})]})]})]}),l&&(0,y.jsx)(`div`,{className:`overflow-x-auto`,children:(0,y.jsxs)(`table`,{className:`w-full text-[10px] text-left`,children:[(0,y.jsx)(`thead`,{className:`bg-slate-100 text-slate-500 uppercase border-y border-slate-200`,children:(0,y.jsxs)(`tr`,{children:[(0,y.jsx)(`th`,{className:`px-4 py-2 font-semibold`,children:`TAG`}),(0,y.jsx)(`th`,{className:`px-4 py-2 font-semibold`,children:`Descripción`}),(0,y.jsx)(`th`,{className:`px-2 py-2 font-semibold w-24`,children:`Skid`}),(0,y.jsx)(`th`,{className:`px-2 py-2 font-semibold w-24`,children:`Almacén`}),(0,y.jsx)(`th`,{className:`px-2 py-2 font-semibold text-center w-16`,children:`Calib?`}),(0,y.jsx)(`th`,{className:`px-2 py-2 font-semibold text-center w-16`,children:`R. Tot`}),(0,y.jsx)(`th`,{className:`px-2 py-2 font-semibold text-center w-16`,children:`R. Real`}),(0,y.jsx)(`th`,{className:`px-2 py-2 font-semibold text-center w-32`,children:`Estado`})]})}),(0,y.jsx)(`tbody`,{children:r.map(e=>(0,y.jsx)(b,{tagItem:e,onEdit:i,skidOptions:a,almacenOptions:o,isReadOnly:c},e.tag))})]})})]})},S=({sys:e,isExpanded:t,onToggle:n,onEdit:r,skidOptions:i,almacenOptions:a,isReadOnly:o})=>{let c=(0,v.useMemo)(()=>{let t={};return e.tags.forEach(e=>{let n=e.specialty||`Sin Especialidad`;t[n]||(t[n]=[]),t[n].push(e)}),t},[e.tags]),l=e.totalTags>0?(e.inProcessTags/e.totalTags*100).toFixed(0):0;return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)(`tr`,{className:`bg-white hover:bg-blue-50 transition-colors border-b border-slate-100 cursor-pointer ${t?`bg-slate-50 border-l-4 border-l-blue-500`:``}`,onClick:n,children:[(0,y.jsxs)(`td`,{className:`px-6 py-4`,children:[(0,y.jsxs)(`div`,{className:`flex items-center gap-2 text-slate-500`,children:[t?(0,y.jsx)(s,{size:18}):(0,y.jsx)(m,{size:18}),(0,y.jsx)(`span`,{className:`font-medium text-slate-800 text-sm`,children:e.sistema})]}),(0,y.jsx)(`div`,{className:`text-xs text-slate-400 pl-6`,children:e.descSistema})]}),(0,y.jsxs)(`td`,{className:`px-6 py-4`,children:[(0,y.jsx)(`div`,{className:`font-medium text-slate-700 text-sm`,children:e.subsistema}),(0,y.jsx)(`div`,{className:`text-xs text-slate-400`,children:e.descSubsistema})]}),(0,y.jsx)(`td`,{className:`px-6 py-4 text-center font-bold text-slate-700 text-sm`,children:e.totalTags}),(0,y.jsx)(`td`,{className:`px-6 py-4 text-center`,children:(0,y.jsx)(`span`,{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold ${e.mountedTags>0?`bg-green-100 text-green-800`:`bg-slate-100 text-slate-500`}`,children:e.mountedTags})}),(0,y.jsx)(`td`,{className:`px-6 py-4`,children:(0,y.jsxs)(`div`,{className:`flex flex-col gap-1`,children:[(0,y.jsxs)(`div`,{className:`flex items-center gap-2`,title:`Instalado (Completado)`,children:[(0,y.jsxs)(`span`,{className:`text-[10px] font-bold w-6 text-right text-slate-500`,children:[e.percent,`%`]}),(0,y.jsx)(`div`,{className:`w-24 bg-slate-100 rounded-full h-1.5`,children:(0,y.jsx)(`div`,{className:`h-1.5 rounded-full ${parseFloat(e.percent)===100?`bg-green-600`:parseFloat(e.percent)>50?`bg-blue-600`:`bg-orange-400`}`,style:{width:`${e.percent}%`}})})]}),(0,y.jsxs)(`div`,{className:`flex items-center gap-2`,title:`En Proceso (Iniciado)`,children:[(0,y.jsxs)(`span`,{className:`text-[10px] font-bold w-6 text-right text-yellow-600`,children:[l,`%`]}),(0,y.jsx)(`div`,{className:`w-24 bg-slate-100 rounded-full h-1.5`,children:(0,y.jsx)(`div`,{className:`h-1.5 rounded-full bg-yellow-500`,style:{width:`${l}%`}})})]})]})})]}),t&&(0,y.jsx)(`tr`,{children:(0,y.jsx)(`td`,{colSpan:`5`,className:`p-4 bg-slate-50 border-b border-slate-200 shadow-inner`,children:(0,y.jsxs)(`div`,{className:`pl-6`,children:[(0,y.jsxs)(`h4`,{className:`text-xs font-bold text-slate-400 uppercase mb-3 flex items-center gap-2 tracking-wider`,children:[(0,y.jsx)(p,{size:14}),` Detalle por Especialidad (ABM)`]}),Object.keys(c).sort().map(e=>(0,y.jsx)(x,{specialtyName:e,tags:c[e],onEdit:r,skidOptions:i,almacenOptions:a,isReadOnly:o},e))]})})})]})},C=()=>{let{matrix:i,edits:a,loading:o,saveData:s}=d(),{user:l,access:p}=f(),[m,b]=(0,v.useState)({}),x=(0,v.useMemo)(()=>{if(!i)return{skids:[],almacenes:[]};let e=new Set,t=new Set;return i.forEach(n=>{n.skid?.trim()&&e.add(n.skid.trim()),n.almacen?.trim()&&t.add(n.almacen.trim())}),t.add(`EN OBRA`),{skids:Array.from(e).sort(),almacenes:Array.from(t).sort()}},[i]),C=(0,v.useCallback)((e,t)=>{let n=c.safeParseInt(t?.cantRegTot??e.cantRegTot),r=c.safeParseInt(t?.cantRegReal??e.cantRegReal);return n>0&&r>=n?`INSTALADO`:r>0&&r<n?`EN PROCESO`:`PENDIENTE`},[]),w=(0,v.useMemo)(()=>{if(!i)return{systems:[],globalProgress:0,totalTagsScope:0,registryStats:{total:0,real:0},specialtyStats:[]};let n={},r=0,o={I:0,E:0,P:0,M:0,C:0},s={...o},l=0,u=0;i.forEach(e=>{if((e.estado1||``).toUpperCase().includes(`ELIMINA`))return;let t=a?.[e.tag]||{},i=c.safeParseInt(t?.cantRegTot??e.cantRegTot),d=c.safeParseInt(t?.cantRegReal??e.cantRegReal);l+=i,u+=d;let f=C(e,t),p=f===`INSTALADO`,m=`${e.sistema||`000`}|${e.subsistema||`000`}`,h=e.sistema||``,g=e.subsistema||``;n[m]||(n[m]={id:m,sistema:`${e.sistema} - ${e.descSistema}`,descSistema:e.descSistema,subsistema:`${e.subsistema} - ${e.descSubsistema}`,descSubsistema:e.descSubsistema,totalTags:0,mountedTags:0,inProcessTags:0,tags:[],rawSys:h,rawSub:g}),n[m].totalTags++,p&&n[m].mountedTags++,f===`EN PROCESO`&&(n[m].inProcessTags=(n[m].inProcessTags||0)+1),n[m].tags.push({tag:e.tag,desc:e.descripcion,specialty:e.especialidad,calculatedStatus:f,skid:t?.skid??e.skid,almacen:t?.almacen??e.almacen,aCalibrar:t?.aCalibrar??e.aCalibrar,cantRegTot:t?.cantRegTot??e.cantRegTot,cantRegReal:t?.cantRegReal??e.cantRegReal}),r++;let _=(e.especialidad||``).toUpperCase(),v=null;_.includes(`INSTRUMENT`)||_.includes(`(I)`)?v=`I`:_.includes(`ELECTRIC`)||_.includes(`(E)`)?v=`E`:_.includes(`PIPING`)||_.includes(`(P)`)?v=`P`:_.includes(`MEC`)||_.includes(`(M)`)?v=`M`:(_.includes(`CIVIL`)||_.includes(`(C)`))&&(v=`C`),v&&(s[v]+=i,o[v]+=d)});let d=l>0?(u/l*100).toFixed(2):`0.00`;return{systems:Object.values(n).map(e=>({...e,percent:e.totalTags>0?(e.mountedTags/e.totalTags*100).toFixed(1):`0.0`})).sort((e,t)=>{let n=String(e.rawSys||``).substring(0,3),r=String(t.rawSys||``).substring(0,3),i=n.localeCompare(r,void 0,{numeric:!0,sensitivity:`base`});if(i!==0)return i;let a=String(e.rawSub||``).substring(0,2),o=String(t.rawSub||``).substring(0,2);return a.localeCompare(o,void 0,{numeric:!0,sensitivity:`base`})}),globalProgress:d,totalTagsScope:r,registryStats:{total:l,real:u},specialtyStats:[{label:`Instrumentación (I)`,val:o.I,tot:s.I,color:`#3b82f6`,icon:e},{label:`Electricidad (E)`,val:o.E,tot:s.E,color:`#eab308`,icon:_},{label:`Piping (P)`,val:o.P,tot:s.P,color:`#6366f1`,icon:g},{label:`Mecánica (M)`,val:o.M,tot:s.M,color:`#64748b`,icon:t},{label:`Civil (C)`,val:o.C,tot:s.C,color:`#f97316`,icon:h}]}},[i,a,C]),T=(e,t,n)=>{if(!p.canEdit)return;let r={...a},o={...r[e]||{},[t]:n};if(t===`cantRegReal`){let t=i.find(t=>t.tag===e),r=c.safeParseInt(o.cantRegTot??(t?.cantRegTot||0));r>0&&c.safeParseInt(n)>=r&&(o.almacen=`EN OBRA`)}r[e]=o,s(null,null,r,null,l.email)};return o&&(!i||i.length===0)?(0,y.jsx)(`div`,{className:`flex h-64 justify-center items-center`,children:(0,y.jsx)(n,{className:`animate-spin text-blue-500`})}):!i||i.length===0?(0,y.jsxs)(`div`,{className:`flex flex-col items-center justify-center h-96 bg-white rounded-lg border border-dashed border-slate-300`,children:[(0,y.jsx)(u,{className:`w-16 h-16 text-slate-300 mb-4`}),(0,y.jsx)(`h3`,{className:`text-lg font-medium text-slate-500`,children:`No hay datos de matriz ABM`}),(0,y.jsx)(`p`,{className:`text-sm text-slate-400 mt-2`,children:`Carga un archivo "Matriz ABM" usando el botón superior derecho.`})]}):(0,y.jsxs)(`div`,{children:[(0,y.jsx)(`div`,{className:`grid grid-cols-1 md:grid-cols-5 gap-4 mb-6`,children:w.specialtyStats.map(e=>(0,y.jsx)(r,{title:e.label,value:`${e.val}/${e.tot}`,icon:e.icon,color:e.color,compact:!0,percentage:e.tot>0?e.val/e.tot*100:0},e.label))}),(0,y.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-4 gap-4 mb-8`,children:[(0,y.jsxs)(`div`,{className:`bg-white p-4 rounded-lg shadow border-l-4 border-purple-500`,children:[(0,y.jsx)(`h3`,{className:`text-sm font-medium text-gray-500 uppercase`,children:`Subsistemas`}),(0,y.jsx)(`p`,{className:`text-3xl font-bold text-gray-800`,children:w.systems.length})]}),(0,y.jsxs)(`div`,{className:`bg-white p-4 rounded-lg shadow border-l-4 border-blue-500`,children:[(0,y.jsx)(`h3`,{className:`text-sm font-medium text-gray-500 uppercase`,children:`Total Tags`}),(0,y.jsx)(`p`,{className:`text-3xl font-bold text-gray-800`,children:w.totalTagsScope})]}),(0,y.jsxs)(`div`,{className:`bg-white p-4 rounded-lg shadow border-l-4 border-cyan-500`,children:[(0,y.jsx)(`h3`,{className:`text-sm font-medium text-gray-500 uppercase`,children:`Total Registros`}),(0,y.jsxs)(`div`,{className:`flex flex-col`,children:[(0,y.jsxs)(`p`,{className:`text-3xl font-bold text-gray-800`,children:[w.registryStats.real,` `,(0,y.jsxs)(`span`,{className:`text-lg text-gray-400 font-normal`,children:[` / `,w.registryStats.total]})]}),(0,y.jsx)(`div`,{className:`w-full bg-slate-100 rounded-full h-1.5 mt-2`,children:(0,y.jsx)(`div`,{className:`h-1.5 rounded-full bg-cyan-500 transition-all duration-500`,style:{width:`${w.registryStats.total>0?w.registryStats.real/w.registryStats.total*100:0}%`}})})]})]}),(0,y.jsxs)(`div`,{className:`bg-white p-4 rounded-lg shadow border-l-4 border-green-600`,children:[(0,y.jsx)(`h3`,{className:`text-sm font-medium text-gray-500 uppercase`,children:`Avance Global`}),(0,y.jsxs)(`p`,{className:`text-3xl font-bold text-gray-800 flex items-center gap-2`,children:[w.globalProgress,`% `,(0,y.jsx)(e,{size:20,className:`text-green-500`})]})]})]}),(0,y.jsx)(`div`,{className:`bg-white rounded shadow overflow-hidden border border-slate-200`,children:(0,y.jsxs)(`table`,{className:`w-full text-sm text-left`,children:[(0,y.jsx)(`thead`,{className:`bg-slate-100 text-slate-700 uppercase text-xs`,children:(0,y.jsxs)(`tr`,{children:[(0,y.jsx)(`th`,{className:`px-6 py-3`,children:`Sistema`}),(0,y.jsx)(`th`,{className:`px-6 py-3`,children:`Subsistema`}),(0,y.jsx)(`th`,{className:`px-6 py-3 text-center`,children:`Total`}),(0,y.jsx)(`th`,{className:`px-6 py-3 text-center`,children:`Inst.`}),(0,y.jsx)(`th`,{className:`px-6 py-3`,children:`Avance`})]})}),(0,y.jsx)(`tbody`,{className:`divide-y divide-slate-100`,children:w.systems.map(e=>(0,y.jsx)(S,{sys:e,isExpanded:m[e.id],onToggle:()=>b(t=>({...t,[e.id]:!t[e.id]})),onEdit:T,skidOptions:x.skids,almacenOptions:x.almacenes,isReadOnly:!p.canEdit},e.id))})]})})]})};export{C as default};