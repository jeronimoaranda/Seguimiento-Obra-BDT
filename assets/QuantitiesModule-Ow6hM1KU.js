import{t as e}from"./activity-CITf3QsN.js";import{a as t,c as n,d as r,l as i,m as a,o,s,t as c}from"./index-CvE6lVIl.js";var l=t(`calendar`,[[`path`,{d:`M8 2v4`,key:`1cmpym`}],[`path`,{d:`M16 2v4`,key:`4m81vk`}],[`rect`,{width:`18`,height:`18`,x:`3`,y:`4`,rx:`2`,key:`1hopcy`}],[`path`,{d:`M3 10h18`,key:`8toen8`}]]),u=t(`grid-3x3`,[[`rect`,{width:`18`,height:`18`,x:`3`,y:`3`,rx:`2`,key:`afitv7`}],[`path`,{d:`M3 9h18`,key:`1pudct`}],[`path`,{d:`M3 15h18`,key:`5xshup`}],[`path`,{d:`M9 3v18`,key:`fh3hqa`}],[`path`,{d:`M15 3v18`,key:`14nvp0`}]]),d=t(`square-pen`,[[`path`,{d:`M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7`,key:`1m0v6g`}],[`path`,{d:`M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z`,key:`ohrbg2`}]]),f=a(r(),1),p=n(),m=f.memo(({discipline:e,activity:t,rawData:n,dateColumns:r,isSourceCumulative:a,TODAY_ISO:o,globalTargetDate:s,onOpenModal:c})=>{let u=(0,f.useRef)(null),m=(0,f.useRef)(null),[h,g]=(0,f.useState)(s),[_,v]=(0,f.useState)(!1);(0,f.useEffect)(()=>{if(window.Chart){v(!0);return}let e=document.createElement(`script`);e.src=`https://cdn.jsdelivr.net/npm/chart.js/dist/chart.umd.min.js`,e.async=!0,e.onload=()=>v(!0),document.body.appendChild(e)},[]);let y=(0,f.useMemo)(()=>{let s=n.find(n=>n.Disciplina===e&&n.Actividad===t&&i.isLineaBase(n.Curva)),c=n.find(n=>n.Disciplina===e&&n.Actividad===t&&i.isAvanceReal(n.Curva));if(!s)return null;let l=0,u=0,d=``,f=e=>{if(!e)return``;let t=Object.keys(e).find(e=>i.normalizeText(e)===`unidad`);return t?e[t]:``};if(d=f(c)||f(s)||``,c){let e=Object.keys(c).find(e=>i.normalizeText(e)===`actual`),t=Object.keys(c).find(e=>i.normalizeText(e)===`remanente`);e&&(l=i.parseNumber(c[e])),t&&(u=i.parseNumber(c[t]))}let p=0;l>0||u>0?p=l+u:r.forEach(e=>{if(s[e]!==void 0){let t=i.parseNumber(s[e]);a?t>p&&(p=t):p+=t}}),p===0&&(p=i.parseNumber(s.Alcance)||100);let m=[],g=0,_=null,v=0,y=-1;for(let e=0;e<r.length&&r[e]<=o;e++)y=e;let b=r.findIndex(e=>e>=h),x=b===-1?r.length-1:b;r.forEach((e,t)=>{let n=s[e],r=0;a?(r=n==null||n===``?g:i.parseNumber(n),m.push(r),g=r):(r=i.parseNumber(n),g+=r,m.push(g)),!_&&g>=p*.999&&(_=e),t===y&&(v=g)});let S=[],C=[],w=[],T=0;c&&r.forEach((e,t)=>{let n=c[e],r=0,o=n!=null&&n.toString().trim()!==``;a?(r=o?i.parseNumber(n):T,r<T&&r===0&&(r=T),T=r):(r=i.parseNumber(n),T+=r),t<=y?(t===y&&l>0&&(T=l),S.push(T),C.push(null),w.push(null)):(S.push(null),o||a&&T>0?C.push(T):C.push(null),w.push(null))});let E=y>=0?S[y]:0;y>=0&&y<r.length&&(C[y]=E,w[y]=E);let D=0,O=x-y,k=u>0?u:p-E;O>0&&k>0&&(D=k/O);let A=E;for(let e=y+1;e<r.length;e++)A<p&&(A+=D,A>p&&(A=p)),w[e]=A;let j=p>0?E/p*100:0,M=p>0?v/p*100:0,N=p>0?(k/p*100).toFixed(1):0,P=E-v,F=(j-M).toFixed(1);return{labels:r,datasets:[{label:`Línea Base`,data:m,borderColor:`#2563eb`,borderWidth:2,pointRadius:0,order:3},{label:`Real`,data:S,borderColor:`#ea580c`,borderWidth:3,pointRadius:1,fill:!1,spanGaps:!1,order:1},{label:`Proy. Archivo`,data:C,borderColor:`#fb923c`,borderDash:[2,2],borderWidth:2,pointRadius:0,spanGaps:!0,order:2},{label:`Proy. Objetivo`,data:w,borderColor:`#16a34a`,borderDash:[5,5],borderWidth:2,pointRadius:0,spanGaps:!0,order:1}],kpi:{totalScope:p,currentProgress:E,baseAtCutoff:v,deviation:P,deviationPct:F,pct:j.toFixed(1),remanente:k,remanentePct:N,cutoffIndex:y,projectionRate:D,unit:d}}},[n,e,t,r,a,h,o]);return(0,f.useEffect)(()=>{if(!y||!u.current||!_)return;m.current&&m.current.destroy();let e=u.current.getContext(`2d`);return m.current=new window.Chart(e,{type:`line`,data:y,plugins:[{id:`valueLabels`,afterDatasetsDraw:e=>{let{ctx:t}=e,n=y.kpi.cutoffIndex;if(n===-1)return;let r=e.getDatasetMeta(0),i=e.getDatasetMeta(1);if(!r.data[n]||!i.data[n])return;let a=r.data[n].x,o=r.data[n].y,s=i.data[n].y;t.font=`bold 10px sans-serif`,t.textAlign=`left`,t.textBaseline=`middle`;let c=y.kpi.baseAtCutoff.toLocaleString(`es-ES`,{maximumFractionDigits:0}),l=y.kpi.currentProgress.toLocaleString(`es-ES`,{maximumFractionDigits:0});t.fillStyle=`#ea580c`,t.fillText(l,a+6,s-6),t.beginPath(),t.arc(a,s,3,0,2*Math.PI),t.fill(),t.fillStyle=`#2563eb`,t.fillText(c,a+6,o+6),t.beginPath(),t.arc(a,o,3,0,2*Math.PI),t.fill(),t.save(),t.beginPath(),t.moveTo(a,e.chartArea.top),t.lineTo(a,e.chartArea.bottom),t.lineWidth=1,t.strokeStyle=`rgba(100, 116, 139, 0.5)`,t.setLineDash([3,3]),t.stroke(),t.restore()}}],options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:`index`,intersect:!1},plugins:{legend:{display:!0,position:`top`,labels:{boxWidth:10,font:{size:10}}},tooltip:{enabled:!0}},scales:{x:{grid:{display:!1},ticks:{display:!0,autoSkip:!0,maxTicksLimit:12,maxRotation:45,minRotation:45,font:{size:9},callback:function(e){let t=this.getLabelForValue(e);if(!t)return``;let n=t.split(`-`);return n.length===3?`${n[2]}/${n[1]}/${n[0].slice(2)}`:t}}},y:{display:!0,grid:{color:`#f1f5f9`},ticks:{font:{size:10}}}},layout:{padding:{right:20,top:20,bottom:10}}}}),()=>{m.current&&m.current.destroy()}},[y,_]),y?(0,p.jsxs)(`div`,{className:`bg-white rounded-xl shadow-sm border border-slate-200 p-4 flex flex-col h-full hover:shadow-md transition-shadow`,children:[(0,p.jsxs)(`div`,{className:`flex justify-between items-start mb-3`,children:[(0,p.jsxs)(`div`,{children:[(0,p.jsx)(`h3`,{className:`font-bold text-slate-800 text-sm leading-tight`,children:t}),(0,p.jsx)(`p`,{className:`text-xs text-slate-500`,children:e})]}),(0,p.jsxs)(`div`,{className:`px-2 py-1 rounded text-xs font-bold flex items-center gap-2 ${y.kpi.deviation>=0?`bg-green-100 text-green-700`:`bg-red-100 text-red-700`}`,children:[(0,p.jsx)(`span`,{className:`text-xs text-slate-500 font-normal border-r border-slate-300 pr-2 mr-1`,title:`Tasa Semanal Objetivo`,children:y.kpi.projectionRate>0?y.kpi.projectionRate.toLocaleString(`es-ES`,{maximumFractionDigits:0})+` `+y.kpi.unit+`/sem`:`-`}),y.kpi.deviation>=0?`+`:``,y.kpi.deviationPct,`%`]})]}),(0,p.jsx)(`div`,{className:`flex-1 w-full min-h-[220px] relative`,children:(0,p.jsx)(`canvas`,{ref:u})}),(0,p.jsxs)(`div`,{className:`mt-3 pt-3 border-t border-slate-100 grid grid-cols-2 gap-4 text-xs`,children:[(0,p.jsxs)(`div`,{className:`flex flex-col`,children:[(0,p.jsx)(`span`,{className:`text-slate-400 font-medium uppercase tracking-wider mb-1`,children:`Avance Real`}),(0,p.jsxs)(`div`,{className:`flex items-baseline gap-1`,children:[(0,p.jsxs)(`span`,{className:`text-lg font-bold text-slate-800`,children:[y.kpi.pct,`%`]}),(0,p.jsxs)(`span`,{className:`text-slate-500`,children:[`(`,y.kpi.currentProgress.toLocaleString(`es-ES`,{maximumFractionDigits:0}),` `,y.kpi.unit,`)`]})]}),(0,p.jsx)(`div`,{className:`w-full bg-slate-100 rounded-full h-1.5 mt-1 overflow-hidden`,children:(0,p.jsx)(`div`,{className:`bg-blue-600 h-1.5 rounded-full`,style:{width:`${Math.min(y.kpi.pct,100)}%`}})})]}),(0,p.jsxs)(`div`,{className:`flex flex-col items-end`,children:[(0,p.jsx)(`span`,{className:`text-slate-400 font-medium uppercase tracking-wider mb-1`,children:`Faltante`}),(0,p.jsxs)(`div`,{className:`flex items-baseline gap-1`,children:[(0,p.jsxs)(`span`,{className:`text-lg font-bold text-amber-600`,children:[y.kpi.remanentePct,`%`]}),(0,p.jsxs)(`span`,{className:`text-slate-500`,children:[`(`,y.kpi.remanente.toLocaleString(`es-ES`,{maximumFractionDigits:0}),` `,y.kpi.unit,`)`]})]}),(0,p.jsx)(`div`,{className:`w-full bg-slate-100 rounded-full h-1.5 mt-1 overflow-hidden flex justify-end`,children:(0,p.jsx)(`div`,{className:`bg-amber-500 h-1.5 rounded-full`,style:{width:`${Math.min(y.kpi.remanentePct,100)}%`}})})]})]}),(0,p.jsxs)(`div`,{className:`mt-3 flex items-center gap-2`,children:[(0,p.jsxs)(`div`,{className:`flex-1 relative`,children:[(0,p.jsx)(`input`,{type:`date`,value:h,onChange:e=>g(e.target.value),className:`bg-slate-50 border border-slate-200 rounded px-2 py-1.5 text-xs w-full focus:outline-none focus:border-blue-400 text-slate-600`}),(0,p.jsx)(`span`,{className:`absolute right-2 top-1.5 pointer-events-none text-slate-400`,children:(0,p.jsx)(l,{className:`w-3 h-3`})})]}),(0,p.jsxs)(`button`,{onClick:()=>c(e,t,h),className:`py-1.5 px-3 bg-blue-50 text-blue-600 text-xs font-medium rounded hover:bg-blue-100 transition-colors flex items-center justify-center gap-1 border border-blue-100`,children:[(0,p.jsx)(d,{className:`w-3 h-3`}),` Carga Cant.`]})]})]}):null}),h=({quantities:t,saveData:n,currentUserEmail:r,canEdit:a})=>{let[o,s]=(0,f.useState)([]),[l,h]=(0,f.useState)([]),[g,_]=(0,f.useState)(!1),[v,y]=(0,f.useState)(!1),[b,x]=(0,f.useState)({date:new Date().toISOString().split(`T`)[0],value:``}),[S,C]=(0,f.useState)({discipline:``,activity:``}),[w,T]=(0,f.useState)(``),[E,D]=(0,f.useState)(`2026-04-17`);(0,f.useEffect)(()=>{if(t&&t.length>0){let e=new Set;t.forEach(t=>Object.keys(t).forEach(t=>e.add(t)));let n=i.sortHeaders(Array.from(e));s(n);let r=n.filter(e=>!isNaN(Date.parse(e))&&e.includes(`-`));r.sort((e,t)=>new Date(e)-new Date(t));let a=new Date().toISOString().split(`T`)[0],o=``;for(let e=0;e<r.length&&r[e]<=a;e++)o=r[e];T(o||(r.length>0?r[0]:a));let c=[],l=new Set;t.forEach(e=>{let t=`${e.Disciplina}|${e.Actividad}`;!l.has(t)&&e.Disciplina&&e.Actividad&&(l.add(t),c.push({discipline:e.Disciplina,activity:e.Actividad}))}),h(c)}else s([`Curva`,`Disciplina`,`Actividad`,`Alcance`,`Actual`,`Remanente`,`unidad`]),h([]),T(new Date().toISOString().split(`T`)[0])},[t]);let O=e=>{if(!e)return`Sin datos`;let t=e.split(`-`);return t.length===3?`${t[2]}-${t[1]}-${t[0]}`:e},k=(0,f.useMemo)(()=>{let e=o.filter(e=>!isNaN(Date.parse(e))&&e.includes(`-`));if(e.length===0)return[];let t=[...e].sort((e,t)=>new Date(e)-new Date(t)),n=new Date(t[0]),r=new Date(t[t.length-1]),i=e=>e.toISOString().split(`T`)[0],a=[];for(let e=4;e>=1;e--){let t=new Date(n);t.setDate(t.getDate()-e*7),a.push(i(t))}let s=[];for(let e=1;e<=4;e++){let t=new Date(r);t.setDate(t.getDate()+e*7),s.push(i(t))}return[...a,...t,...s]},[o]),A=(e,n,r)=>{if(!a){alert(`No tienes permisos para editar.`);return}C({discipline:e,activity:n});let o=t.find(t=>t.Disciplina===e&&t.Actividad===n&&i.isAvanceReal(t.Curva)),s=o&&o[b.date]?o[b.date]:``;x(e=>({...e,value:s})),_(!0)};return(0,p.jsxs)(`div`,{className:`min-h-screen bg-slate-50`,children:[(0,p.jsx)(`div`,{className:`mb-6 bg-white rounded-xl shadow-sm p-4 md:p-6 sticky top-0 z-10 border border-slate-200`,children:(0,p.jsxs)(`div`,{className:`flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4`,children:[(0,p.jsxs)(`div`,{className:`flex-1 min-w-0`,children:[(0,p.jsxs)(`h1`,{className:`text-2xl font-bold text-slate-900 flex items-center gap-2 truncate`,children:[(0,p.jsx)(u,{className:`text-blue-600 w-6 h-6 flex-shrink-0`}),(0,p.jsx)(`span`,{className:`truncate`,children:`Seguimiento de Cantidades`})]}),(0,p.jsxs)(`p`,{className:`text-slate-500 text-sm mt-1 truncate`,children:[`Visualización Multi-Actividad | Corte: `,O(w)]})]}),(0,p.jsxs)(`div`,{className:`flex items-center gap-3 flex-wrap w-full lg:w-auto justify-start lg:justify-end`,children:[(0,p.jsxs)(`div`,{className:`flex items-center gap-2 bg-slate-50 border border-slate-200 rounded-lg px-3 py-1.5 flex-shrink-0`,children:[(0,p.jsx)(`span`,{className:`text-xs font-bold text-slate-500 uppercase`,children:`Meta Global:`}),(0,p.jsx)(`input`,{type:`date`,value:E,onChange:e=>D(e.target.value),className:`bg-transparent text-sm focus:outline-none text-slate-700`})]}),(0,p.jsx)(`button`,{onClick:()=>y(!v),className:`px-3 py-2 rounded-lg text-xs font-bold transition-colors shadow-sm flex-shrink-0 ${v?`bg-blue-100 text-blue-700`:`bg-slate-100 text-slate-600 hover:bg-slate-200`}`,children:v?`Datos Acumulados`:`Datos Semanales`})]})]})}),(0,p.jsx)(`div`,{className:``,children:l.length>0?(0,p.jsx)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6`,children:l.map((e,n)=>(0,p.jsx)(m,{discipline:e.discipline,activity:e.activity,rawData:t,dateColumns:k,isSourceCumulative:v,TODAY_ISO:w,globalTargetDate:E,onOpenModal:A},`${e.discipline}-${e.activity}-${n}`))}):(0,p.jsxs)(`div`,{className:`flex flex-col items-center justify-center h-64 text-slate-400 border-2 border-dashed border-slate-300 rounded-xl bg-slate-50/50`,children:[(0,p.jsx)(e,{className:`w-16 h-16 mb-4 opacity-20`}),(0,p.jsx)(`p`,{className:`text-lg font-medium`,children:`Sin datos para mostrar`}),(0,p.jsx)(`p`,{className:`text-sm mt-2`,children:`Utilice el menú "Cargar Datos" en la barra superior para importar su CSV.`})]})}),g&&(0,p.jsx)(`div`,{className:`fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50`,children:(0,p.jsxs)(`div`,{className:`bg-white rounded-xl shadow-xl w-full max-w-md overflow-hidden`,children:[(0,p.jsxs)(`div`,{className:`px-6 py-4 border-b flex justify-between items-center bg-slate-50`,children:[(0,p.jsxs)(`h3`,{className:`font-bold text-slate-800 flex items-center gap-2`,children:[(0,p.jsx)(d,{className:`w-4 h-4 text-blue-600`}),` Editar: `,S.activity]}),(0,p.jsx)(`button`,{onClick:()=>_(!1),className:`text-slate-400 hover:text-slate-600`,children:(0,p.jsx)(c,{className:`w-5 h-5`})})]}),(0,p.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,p.jsxs)(`div`,{children:[(0,p.jsx)(`label`,{className:`block text-sm font-medium text-slate-700 mb-1`,children:`Fecha de Registro`}),(0,p.jsx)(`input`,{type:`date`,className:`w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none`,value:b.date,onChange:e=>x(t=>({...t,date:e.target.value}))})]}),(0,p.jsxs)(`div`,{children:[(0,p.jsxs)(`label`,{className:`block text-sm font-medium text-slate-700 mb-1`,children:[`Valor `,v?`Acumulado`:`del Periodo`]}),(0,p.jsx)(`input`,{type:`number`,className:`w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none`,placeholder:`0.00`,value:b.value,onChange:e=>x(t=>({...t,value:e.target.value}))})]})]}),(0,p.jsxs)(`div`,{className:`px-6 py-4 bg-slate-50 flex justify-end gap-2 border-t`,children:[(0,p.jsx)(`button`,{onClick:()=>_(!1),className:`px-4 py-2 text-slate-600 hover:bg-slate-200 rounded-lg font-medium text-sm`,children:`Cancelar`}),(0,p.jsx)(`button`,{onClick:()=>{if(!S.discipline||!S.activity||!b.date)return;let e=[...t],a=e.findIndex(e=>e.Disciplina===S.discipline&&e.Actividad===S.activity&&i.isAvanceReal(e.Curva));if(a===-1){let t=e.find(e=>e.Disciplina===S.discipline&&e.Actividad===S.activity);e.push({Curva:`Avance Real`,Disciplina:S.discipline,Actividad:S.activity,Alcance:t?.Alcance,Actual:t?.Actual||0,Remanente:t?.Remanente||0,unidad:t?.unidad}),a=e.length-1}e[a][b.date]=parseFloat(b.value);let s=[...o];s.includes(b.date)||s.push(b.date);let c=0,l=-1,u=i.sortHeaders(s.filter(e=>!isNaN(Date.parse(e)))),d=new Date().toISOString().split(`T`)[0];for(let e=0;e<u.length&&u[e]<=d;e++)l=e;u.forEach((t,n)=>{if(n<=l){let n=i.parseNumber(e[a][t]);v?n>0&&(c=n):c+=n}});let f=Object.keys(e[a]).find(e=>i.normalizeText(e)===`actual`);f?e[a][f]=c:e[a].Actual=c,n(null,null,null,e,r),_(!1)},disabled:!b.date,className:`px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg shadow disabled:opacity-50 font-medium text-sm`,children:`Guardar Cambios`})]})]})})]})},g=()=>{let{quantities:e,saveData:t}=o(),{user:n,access:r}=s();return(0,p.jsx)(h,{quantities:e,saveData:t,currentUserEmail:n?.email,canEdit:r.canEdit})};export{g as default};